<% @owner1 = Owner.find(params[:owner_1]) %>
<% @owner2 = Owner.find(params[:owner_2]) %>
<% @tally = { :owner1 => 0, :owner2 => 0, :ties => 0 } %>
<% @h2h_games = [] %>
<% @filtered_games = Game.games_by_type(params[:game_type]) %>
<% @filtered_games.each do |game| %>
  <% if game.home_team_owner == @owner1 && game.away_team_owner == @owner2 || game.home_team_owner == @owner2 && game.away_team_owner == @owner1 %>
    <% @h2h_games.push(game) %>
    <% if game.winner %>
      <% game.winner.owner.id == @owner1.id ? @tally[:owner1] += 1 : @tally[:owner2] += 1 %>
    <% else %>
      <% @tally[:ties] += 1 %>
    <% end %>
  <% end %>
<% end %>

$('#h2h-result').empty();
$('#h2h-result').append('<%= j render :partial => 'h2hresult', :locals => { :h2h_games => @h2h_games, :tally => @tally, :owner1 => @owner1, :owner2 => @owner2 }, :layout => false %>');